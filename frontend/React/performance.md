# React 的性能问题

React 最大的一个性能问题就是 React 的某个组件的更新会连带着他的子组件进行一起更新。所以要解决这个问题：

- 1.源码上尽量弥补这个问题
- 2.让子组件只做合理的更新

## React 的时间切片

Vue 有依赖收集，做到最小化的更新范围，而 React 没有做到这个事情，所以 React 要更新就会有很大的 diff 算法对比和计算工作。

这么大的更新量，虚拟 dom 对比和计算会花很多时间。可能会阻塞浏览器的工作。可能导致长时间的白屏。

React 为了解决这个问题选择另一种策略---时间切片。也就是先计算一部分更新，然后让渡给渲染进程。然后进行下一步的更新。以此往复，这样我们从使用者的角度来看，就不会有长时间的白屏了。

## fiber

为了支持这种切片，我们需要把更新化成一个个单元，然后也要有恢复上一次计算进度的能力。

所以 React 设计了一种数据结构 fiber。

每一个组件都会被转化为一个 fiber 结构的对象。组成一个个单元。fiber 让我们有了恢复上一次计算进度的能力。

## 避免父组件数据更改导致子组件的更新。

如果是 class 组件的写法就集成 PureComponent
如果函数式写法就使用 memo

## 避免 state 同样的值产生更新。

避免 state 修改为同样的值，而产生无意义的更新（PureComponent，函数组件本身会判断）

## props

如果组件使用了 PureComponent，或者 React.Memo 虽然已经做到了父组件传递的 props 不变就不会更新。但是我们特别注意父组件传入的方法，对象，数组这样的引用数据类型。

用 useCallback 包裹传递给子组件的方法

非 state 对象，数组数据，要用 useMemo 包裹起来
