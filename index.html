<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <!-- 只能压缩jpg -->
    <input type="file" id="file" />
    <script>
      class CompressImg {
        options;
        fileReader = new FileReader();
        constructor(options) {
          this.options = options;
          this.createBase64();
        }
        createBase64() {
          this.fileReader.onload = (e) => {
            console.log(e.target.result);
            this.compress(e.target.result);
          };
          this.fileReader.readAsDataURL(this.options.file);
        }
        compress(url) {
          const canvas = document.createElement("canvas");
          const ctx = canvas.getContext("2d");
          const img = new Image();
          img.src = url;
          img.onload = () => {
            canvas.width = img.width;
            canvas.height = img.height;
            ctx?.drawImage(img, 0, 0, img.width, img.height);
            const newBase64 = canvas.toDataURL(
              this.options.file.type,
              this.options.quality
            );
            this.options?.success && this.options?.success(newBase64);
          };
        }
      }
      const file = document.querySelector("#file");
      file.addEventListener("change", (e) => {
        const target = e.target;
        const fileObj = target.files?.[0];
        if (fileObj) {
          new CompressImg({
            file: fileObj,
            quality: 0.1,
            success: (base64) => {
              const img = new Image();
              console.log(base64);
              img.src = base64;
              document.body.appendChild(img);
            },
          });
        }
      });
    </script>
  </body>
</html>
